package apis;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

import cn.hutool.core.lang.Console;
import cn.hutool.http.HttpUtil;
import cn.hutool.json.JSONObject;
import cn.hutool.json.JSONUtil;
import utils.ConsoleControl;
import utils.MyHttpReq;

public class All {

    public static void main(String[] args) {
        ScheduledExecutorService service = Executors.newSingleThreadScheduledExecutor();
        service.scheduleWithFixedDelay(() -> {
            try {
                exec();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }, 0, 2, TimeUnit.SECONDS);
    }

    public static void exec() throws Exception {
        // Console.log();
        List<AskBid> askbid = new ArrayList<AskBid>();
        // https://bitflyer.com/API
        {
            String baseUrl = "https://api.bitflyer.jp/v1/";
            {
                String body = HttpUtil.get(baseUrl + "ticker?product_code=BTC_JPY");
                //System.out.println(body);
                JSONObject jsonObject = JSONUtil.parseObj(body);
                AskBid data = new AskBid(ExchangeDef.bitflyer);
                data.bid = jsonObject.getBigDecimal("best_bid");
                data.ask = jsonObject.getBigDecimal("best_ask");
                askbid.add(data);
            }
            {
                String body = HttpUtil.get(baseUrl + "board?product_code=BTC_JPY");
                //System.out.println(body);
            }
        }
        // https://developers.quoine.com/
        {
            String baseUrl = "https://api.quoine.com/";
            {
                String body = HttpUtil.get(baseUrl + "products/5");
                //System.out.println(body);
                JSONObject jsonObject = JSONUtil.parseObj(body);
                AskBid data = new AskBid(ExchangeDef.quoine);
                data.bid = jsonObject.getBigDecimal("market_bid");
                data.ask = jsonObject.getBigDecimal("market_ask");
                askbid.add(data);
            }
            {
                String body = HttpUtil.get(baseUrl + "products/5/price_levels");
                //System.out.println(body);
            }
        }
        // https://docs.bitbank.cc
        {
            String baseUrl = "https://public.bitbank.cc/";
            {
                //String body = HttpRequest.get(baseUrl + "btc_jpy/ticker").setSSLSocketFactory(MyHttpReq.defaultSSLFactory()).execute().body();
                String body = MyHttpReq.httpGetReq(baseUrl + "btc_jpy/ticker", null);
                //System.out.println(body);
                JSONObject jsonObject = JSONUtil.parseObj(body);
                AskBid data = new AskBid(ExchangeDef.bitbank);
                data.bid = jsonObject.getJSONObject("data").getBigDecimal("buy");
                data.ask = jsonObject.getJSONObject("data").getBigDecimal("sell");
                askbid.add(data);
            }
            {
                String body = MyHttpReq.httpGetReq(baseUrl + "btc_jpy/depth", null);
                //System.out.println(body);
            }
        }
        // https://coincheck.com
        {
            String baseUrl = "https://coincheck.com/";
            {
                String body = HttpUtil.get(baseUrl + "api/ticker");
                //System.out.println(body);
                // {"last":980931.0,"bid":980676.0,"ask":980915.0,"high":1021237.0,"low":965471.0,"volume":5720.8734215,"timestamp":1526019926}
                JSONObject jsonObject = JSONUtil.parseObj(body);
                AskBid data = new AskBid(ExchangeDef.coincheck);
                data.bid = jsonObject.getBigDecimal("bid");
                data.ask = jsonObject.getBigDecimal("ask");
                askbid.add(data);
            }
            {
                String body = HttpUtil.get(baseUrl + "api/order_books");
                // System.out.println(body);
                // {"asks":[["980800.0","0.07"],["980999.0","0.005"],["981000.0","0.38344796"],["981239.0","0.0432"],["981249.0","0.005"],["981499.0","0.005"],["981591.0","0.31981048"],["981610.0","0.005"],["981749.0","0.025"],["981753.0","0.01319309"],["981754.0","2.55"],["981999.0","0.012"],["982000.0","1.3"],["982249.0","0.005"],["982261.0","0.5"],["982410.0","4.4"],["982499.0","0.005"],["982551.0","1.0"],["982749.0","0.0077491"],["982963.0","0.195"],["982999.0","0.012"],["983000.0","1.13890267"],["983055.0","0.005"],["983057.0","0.0104"],["983120.0","3.52"],["983249.0","0.005"],["983385.0","0.007"],["983499.0","0.005"],["983699.0","0.05"],["983749.0","0.005"],["983752.0","0.0104"],["983762.0","2.49"],["983982.0","0.005"],["983999.0","0.012234"],["984051.0","0.05"],["984249.0","0.005"],["984395.0","3.515"],["984493.0","3.672"],["984495.0","2.58"],["984499.0","0.00540117"],["984597.0","12.773"],["984691.0","0.005"],["984749.0","0.005"],["984800.0","0.7"],["984877.0","0.005"],["984959.0","0.12"],["984999.0","0.012"],["985000.0","0.02"],["985151.0","2.36"],["985239.0","0.05"],["985249.0","0.005"],["985451.0","18.94106064"],["985499.0","0.005"],["985523.0","0.005"],["985555.0","0.04"],["985749.0","0.005"],["985825.0","4.06"],["985999.0","0.012"],["986249.0","0.005"],["986490.0","4.42"],["986499.0","0.005"],["986518.0","0.0096"],["986631.0","0.005"],["986712.0","0.0226"],["986749.0","0.005"],["986779.0","0.005"],["986999.0","0.012"],["987192.0","2.63"],["987249.0","0.005"],["987345.0","0.005"],["987499.0","0.007722"],["987749.0","0.005"],["987887.0","0.005"],["987999.0","0.012"],["988249.0","0.005"],["988499.0","0.005"],["988709.0","0.00414145"],["988749.0","0.005"],["988888.0","0.04"],["988999.0","0.012"],["989249.0","0.005"],["989499.0","0.005"],["989500.0","0.005"],["989659.0","0.005"],["989749.0","0.005"],["989820.0","0.005"],["989950.0","0.00921187"],["989999.0","0.012"],["990000.0","0.195"],["990186.0","0.03"],["990249.0","0.005"],["990499.0","0.005"],["990749.0","0.005"],["990963.0","0.0106"],["990999.0","0.012"],["991000.0","0.179"],["991249.0","0.005"],["991499.0","0.005"],["991500.0","0.005"],["991573.0","0.005"],["991749.0","0.005"],["991999.0","0.012"],["992009.0","20.48"],["992222.0","0.04"],["992230.0","0.00382058"],["992249.0","0.005"],["992301.0","0.005"],["992499.0","0.005"],["992702.0","0.0106"],["992749.0","0.005"],["992888.0","0.08168189"],["992999.0","0.012"],["993000.0","0.51010101"],["993001.0","0.01"],["993249.0","0.005"],["993499.0","0.005"],["993749.0","0.005"],["993999.0","0.012"],["994079.0","0.005"],["994198.0","0.005"],["994249.0","0.005"],["994499.0","0.005"],["994749.0","0.005"],["994787.0","0.005"],["994926.0","0.005"],["994999.0","0.012"],["995000.0","0.1"],["995113.0","0.20510443"],["995249.0","0.005"],["995499.0","0.005"],["995555.0","0.04"],["995749.0","0.005"],["995999.0","0.012"],["996000.0","0.0502008"],["996100.0","0.005"],["996209.0","0.01"],["996249.0","0.005"],["996365.0","0.005"],["996499.0","0.005"],["996516.0","23.76"],["996590.0","0.043"],["996749.0","0.005"],["996999.0","0.012"],["997249.0","0.005"],["997268.0","0.005"],["997281.0","0.005"],["997499.0","0.005"],["997549.0","0.005"],["997749.0","0.005"],["997999.0","0.01499839"],["998000.0","0.005"],["998249.0","0.00800702"],["998499.0","0.005"],["998586.0","0.3484"],["998636.0","0.005"],["998749.0","0.005"],["998750.0","0.0164"],["998888.0","0.04"],["998999.0","0.012"],["999000.0","0.64"],["999025.0","0.0102"],["999249.0","0.005"],["999499.0","0.005"],["999523.0","0.005"],["999600.0","0.005"],["999730.0","0.715943"],["999749.0","0.005"],["999999.0","0.012"],["1000000.0","1.22065491"],["1000249.0","0.005"],["1000285.0","0.01"],["1000499.0","0.005"],["1000501.0","0.006"],["1000746.0","0.03"],["1000749.0","0.005"],["1000999.0","0.012"],["1001249.0","0.005"],["1001499.0","0.005"],["1001749.0","0.005"],["1001999.0","0.012"],["1002000.0","0.01002004"],["1002042.0","20.66"],["1002222.0","0.04"],["1002249.0","0.005"],["1002422.0","0.005"],["1002499.0","0.005"],["1002749.0","0.005"],["1002999.0","0.012"],["1003000.0","0.09970089"],["1003100.0","0.5"],["1003123.0","0.015"],["1003170.0","0.02"],["1003249.0","0.005"],["1003499.0","0.005"],["1003749.0","0.005"],["1003975.0","0.04"],["1003999.0","0.012"],["1004249.0","0.005"],["1004397.0","0.005"],["1004499.0","0.005"]],"bids":[["980557.0","0.021"],["980554.0","0.4995"],["980553.0","0.6294"],["980552.0","0.6"],["980544.0","0.0101"],["980501.0","0.005"],["980347.0","0.0101"],["980277.0","0.0101"],["980251.0","0.005"],["980001.0","0.012"],["979901.0","0.03471978"],["979800.0","0.122748"],["979794.0","0.02"],["979751.0","0.005"],["979749.0","0.01461"],["979687.0","0.02"],["979511.0","0.0216"],["979501.0","0.005"],["979439.0","0.0216"],["979425.0","1.02100722"],["979423.0","0.02"],["979407.0","0.005"],["979251.0","0.005"],["979001.0","0.012"],["978831.0","0.43267548"],["978751.0","0.005"],["978630.0","0.5"],["978501.0","0.005"],["978417.0","0.01"],["978251.0","0.005"],["978001.0","0.6198"],["978000.0","0.3"],["977971.0","0.2975"],["977950.0","0.38152558"],["977925.0","0.38152556"],["977862.0","3.74"],["977828.0","0.2"],["977751.0","0.005"],["977503.0","0.005"],["977501.0","0.005"],["977260.0","1.0"],["977251.0","0.005"],["977233.0","1.89"],["977197.0","0.43359755"],["977001.0","0.012"],["976989.0","0.1"],["976882.0","1.91"],["976751.0","0.005"],["976506.0","0.52"],["976501.0","0.005"],["976465.0","2.02"],["976251.0","0.005"],["976109.0","0.04"],["976001.0","0.012"],["976000.0","0.025"],["975831.0","0.01"],["975821.0","0.994"],["975820.0","2.0"],["975819.0","2.0"],["975818.0","2.0"],["975785.0","2.86"],["975763.0","25.0"],["975751.0","0.005"],["975563.0","0.43432385"],["975501.0","0.0091128"],["975500.0","0.05"],["975251.0","0.005"],["975180.0","3.86"],["975059.0","0.005"],["975001.0","0.012"],["975000.0","1.02564102"],["974751.0","0.005"],["974501.0","0.005"],["974500.0","0.206"],["974470.0","2.76"],["974251.0","0.205"],["974001.0","0.012"],["973950.0","0.68200511"],["973925.0","0.67200511"],["973802.0","4.58"],["973751.0","0.22"],["973501.0","0.005"],["973251.0","0.005"],["973086.0","3.63"],["973047.0","6.17"],["973001.0","0.012"],["973000.0","0.1"],["972751.0","0.005"],["972621.0","0.005"],["972501.0","0.005"],["972390.0","3.31"],["972251.0","0.005"],["972214.0","0.01"],["972001.0","0.012"],["972000.0","0.605"],["971751.0","0.005"],["971501.0","0.005"],["971400.0","0.3787"],["971251.0","0.005"],["971001.0","0.012"],["971000.0","0.2608"],["970751.0","0.005"],["970501.0","0.00956821"],["970372.0","0.00515266"],["970251.0","0.005"],["970242.0","0.0102"],["970189.0","0.005"],["970001.0","0.092"],["970000.0","1.75563391"],["969800.0","0.6"],["969782.0","0.0101"],["969751.0","0.005"],["969501.0","0.005"],["969500.0","0.04951005"],["969251.0","0.005"],["969044.0","0.04072673"],["969001.0","0.012"],["969000.0","0.5"],["968751.0","0.005"],["968501.0","0.005"],["968251.0","0.005"],["968001.0","0.012"],["967777.0","0.04649831"],["967763.0","0.005"],["967751.0","0.005"],["967501.0","0.005"],["967500.0","0.356"],["967251.0","0.005"],["967001.0","0.012"],["966790.0","22.09"],["966751.0","0.005"],["966501.0","0.005"],["966251.0","0.005"],["966001.0","0.012"],["966000.0","0.01009316"],["965840.0","0.05218"],["965751.0","0.005"],["965555.0","0.3"],["965501.0","0.005"],["965346.0","0.005"],["965251.0","0.005"],["965150.0","0.00908459"],["965057.0","1.01"],["965050.0","0.5"],["965001.0","1.0203"],["965000.0","14.09368701"],["964751.0","0.005"],["964720.0","0.02"],["964501.0","0.005"],["964444.0","0.046659"],["964251.0","0.005"],["964200.0","0.1"],["964001.0","0.012"],["963800.0","0.1"],["963751.0","0.005"],["963501.0","0.005"],["963251.0","0.005"],["963001.0","0.012"],["963000.0","0.4"],["962932.0","0.005"],["962800.0","0.01"],["962751.0","0.005"],["962501.0","0.005"],["962251.0","0.005"],["962200.0","0.02"],["962022.0","0.03"],["962001.0","0.012"],["962000.0","10.0637"],["961751.0","0.005"],["961501.0","0.005"],["961265.0","0.723159"],["961251.0","0.005"],["961226.0","20.53"],["961111.0","0.04682081"],["961050.0","0.04166815"],["961001.0","0.012"],["961000.0","0.1471"],["960751.0","0.005"],["960749.0","0.0246"],["960525.0","0.005"],["960501.0","0.005"],["960251.0","0.005"],["960050.0","0.05"],["960001.0","0.012"],["960000.0","5.55584998"],["959751.0","0.005"],["959501.0","0.005"],["959292.0","0.005"],["959266.0","25.0"],["959251.0","0.005"],["959001.0","0.012"],["958751.0","0.005"],["958501.0","0.005"],["958251.0","0.005"],["958123.0","0.005"],["958069.0","0.25"],["958001.0","0.012"],["958000.0","0.14958246"],["957777.0","0.04698379"],["957751.0","0.005"]]}
            }
        }
        ConsoleControl.me().cls();
        AskBid bestBuy = askbid.get(0);
        AskBid bestSell = askbid.get(0);
        for (AskBid data : askbid) {
            Console.log(data);
            if (data.ask.compareTo(bestBuy.ask) < 0) {
                bestBuy = data;
            }
            if (data.bid.compareTo(bestSell.bid) > 0) {
                bestSell = data;
            }
        }
        Console.log("----------------------------------------------------------");
        Console.log(String.format("[%10s]Best Buy : %8s", bestBuy.exchange, bestBuy.ask(1)));
        Console.log(String.format("[%10s]Best Sell: %8s", bestSell.exchange, bestSell.bid(1)));
        Console.log(String.format("Profit: %8s", bestSell.bid(1).subtract(bestBuy.ask(1))));
    }

}
